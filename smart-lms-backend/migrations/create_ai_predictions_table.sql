-- Create table to store AI prediction results
CREATE TABLE AIPREDICTIONS (
    ID INT IDENTITY(1, 1) PRIMARY KEY,
    USERID INT NOT NULL,
    PERFORMANCELEVEL NVARCHAR(50) NOT NULL,
    CLUSTERGROUP INT NOT NULL,
    CONFIDENCE FLOAT NOT NULL,
    RECOMMENDATIONS NVARCHAR(MAX),
    CREATEDAT DATETIME2 DEFAULT GETDATE(),
    UPDATEDAT DATETIME2 DEFAULT GETDATE(),
    FOREIGN KEY (USERID) REFERENCES USERS(ID),
    INDEX IX_AIPREDICTIONS_USERID (USERID),
    INDEX IX_AIPREDICTIONS_CREATEDAT (CREATEDAT)
);

-- Add trigger to update UpdatedAt
CREATE TRIGGER TR_AIPREDICTIONS_UPDATEDAT ON AIPREDICTIONS AFTER
    UPDATE AS
BEGIN
    SET NOCOUNT ON;
    UPDATE AIPREDICTIONS
    SET
        UPDATEDAT = GETDATE(
        ) FROM AIPREDICTIONS P INNER JOIN INSERTED I ON P.ID = I.ID;
END;